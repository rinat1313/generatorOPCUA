<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ç–µ–≥–æ–≤ –≤ OPC UA</title>
    <style>
        /* CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π –∏ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã */
        :root {
            --bg-color: #f5f5f5;
            --container-bg: white;
            --text-color: #333;
            --panel-bg: #fafafa;
            --border-color: #ddd;
            --header-color: #2c3e50;
            --table-header-bg: #3498db;
            --table-header-text: white;
            --table-row-even: #f9f9f9;
            --table-row-odd: white;
            --input-bg: white;
            --input-border: #ccc;
            --button-primary: #3498db;
            --button-primary-hover: #2980b9;
            --button-danger: #e74c3c;
            --button-danger-hover: #c0392b;
            --button-success: #27ae60;
            --button-success-hover: #2ecc71;
            --button-warning: #f39c12;
            --button-warning-hover: #e67e22;
            --button-secondary: #95a5a6;
            --button-secondary-hover: #7f8c8d;
            --button-info: #00bcd4;
            --button-info-hover: #00acc1;
            --tab-inactive: #7f8c8d;
            --tab-inactive-bg: #f8f9fa;
            --tab-hover-bg: #e9ecef;
            --tab-hover-text: #2c3e50;
            --non-editable-bg: #f5f5f5;
            --non-editable-text: #555;
            --empty-message: #7f8c8d;
            --footer-bg: #ecf0f1;
            --overlay-bg: rgba(255,255,255,0.8);
            --shadow-color: rgba(0,0,0,0.1);
        }

        /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ - —Å —Å–∏–Ω–∏–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏ */
        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --container-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --panel-bg: #363636;
            --border-color: #444;
            --header-color: #64b5f6;
            --table-header-bg: #1976d2;
            --table-header-text: white;
            --table-row-even: #404040;
            --table-row-odd: #363636;
            --input-bg: #404040;
            --input-border: #555;
            --button-primary: #1976d2;
            --button-primary-hover: #1565c0;
            --button-danger: #d32f2f;
            --button-danger-hover: #b71c1c;
            --button-success: #388e3c;
            --button-success-hover: #2e7d32;
            --button-warning: #f57c00;
            --button-warning-hover: #ef6c00;
            --button-secondary: #616161;
            --button-secondary-hover: #424242;
            --button-info: #0097a7;
            --button-info-hover: #00838f;
            --tab-inactive: #aaa;
            --tab-inactive-bg: #404040;
            --tab-hover-bg: #505050;
            --tab-hover-text: #fff;
            --non-editable-bg: #404040;
            --non-editable-text: #ccc;
            --empty-message: #888;
            --footer-bg: #363636;
            --overlay-bg: rgba(0,0,0,0.8);
            --shadow-color: rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px var(--shadow-color);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0;
            color: var(--header-color);
            transition: color 0.3s;
        }
        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .info-btn {
            background-color: var(--button-warning);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        .info-btn:hover {
            background-color: var(--button-warning-hover);
        }
        .theme-toggle {
            background-color: var(--button-secondary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.3s;
        }
        .theme-toggle:hover {
            background-color: var(--button-secondary-hover);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: var(--container-bg);
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 500px;
            max-width: 80%;
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: background-color 0.3s;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .modal-header h2 {
            margin: 0;
            color: var(--header-color);
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }
        .close-btn:hover {
            color: var(--header-color);
        }
        .modal-body {
            line-height: 1.6;
        }
        .modal-body ul {
            padding-left: 20px;
        }
        h2, h3 {
            color: var(--header-color);
            transition: color 0.3s;
        }
        .panel {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--panel-bg);
            position: relative;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .flex-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .flex-row > div {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        select, button, input[type="checkbox"], input[type="text"] {
            padding: 10px 14px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 15px;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        select {
            min-width: 150px;
        }
        #solutionSelect {
            min-width: 525px;
            max-width: 750px;
        }
        button {
            background-color: var(--button-primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-right: 5px;
            font-size: 15px;
            padding: 10px 16px;
        }
        button:hover {
            background-color: var(--button-primary-hover);
        }
        button.danger {
            background-color: var(--button-danger);
        }
        button.danger:hover {
            background-color: var(--button-danger-hover);
        }
        button.success {
            background-color: var(--button-success);
        }
        button.success:hover {
            background-color: var(--button-success-hover);
        }
        button.warning {
            background-color: var(--button-warning);
        }
        button.warning:hover {
            background-color: var(--button-warning-hover);
        }
        button.secondary {
            background-color: var(--button-secondary);
        }
        button.secondary:hover {
            background-color: var(--button-secondary-hover);
        }
        button.info {
            background-color: var(--button-info);
        }
        button.info:hover {
            background-color: var(--button-info-hover);
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
        .table-container {
            max-height: 750px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin: 15px 0;
            position: relative;
            min-height: 200px;
            transition: border-color 0.3s;
        }
        
        /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ —Ç–∞–±–ª–∏—Ü—ã */
        .table-container table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 0;
            table-layout: fixed;
        }
        
        .table-container thead {
            position: sticky;
            top: 0;
            background-color: var(--table-header-bg);
            z-index: 10;
            transition: background-color 0.3s;
        }
        
        .table-container thead th {
            position: sticky;
            top: 0;
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
            padding: 14px 10px;
            border-bottom: 2px solid var(--border-color);
            font-size: 15px;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è */
        .table-container thead th:nth-child(1) { width: 15%; }
        .table-container thead th:nth-child(2) { width: 25%; }
        .table-container thead th:nth-child(3) { width: 45%; }
        .table-container thead th:nth-child(4) { width: 15%; }
        
        .table-container tbody td {
            background-color: var(--table-row-odd);
            padding: 10px;
            font-size: 14px;
            vertical-align: middle;
            text-align: center;
            transition: background-color 0.3s;
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —è—á–µ–µ–∫ */
        .table-container tbody td:nth-child(1),
        .table-container tbody td:nth-child(2),
        .table-container tbody td:nth-child(3) {
            text-align: center;
        }
        
        .table-container tbody td:nth-child(4) {
            text-align: center;
        }
        
        .table-container tbody tr:nth-child(even) td {
            background-color: var(--table-row-even);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ */
        .checkbox-col {
            text-align: center !important;
            width: 80px;
            min-width: 80px;
        }
        
        .checkbox-col input[type="checkbox"] {
            transform: scale(2.0);
            margin: 8px 0;
            cursor: pointer;
            accent-color: var(--button-primary);
        }
        
        .editable-col {
            text-align: center !important;
            width: 80px;
            min-width: 80px;
        }
        
        .editable-col input[type="checkbox"] {
            transform: scale(2.0);
            margin: 8px 0;
            cursor: pointer;
            accent-color: var(--button-primary);
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –Ω–µ—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ */
        .non-editable-text {
            padding: 8px 10px;
            display: block;
            min-height: 20px;
            background-color: var(--non-editable-bg);
            border-radius: 4px;
            color: var(--non-editable-text);
            width: 100%;
            box-sizing: border-box;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —è—á–µ–π–∫–∏ */
        .editable-input {
            width: 100%;
            box-sizing: border-box;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--text-color);
            padding: 8px 10px;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: var(--button-primary);
            box-shadow: 0 0 3px var(--button-primary);
        }
        
        .footer {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--footer-bg);
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .generation-options {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .generation-options label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }
        
        .generation-options input[type="checkbox"] {
            transform: scale(1.5);
            margin-right: 5px;
            accent-color: var(--button-primary);
        }
        
        .file-input {
            display: none;
        }
        
        /* –¢–∞–±—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è */
        .tabs-container {
            margin-top: 20px;
        }
        
        .tabs-header {
            display: flex;
            border-bottom: 2px solid var(--table-header-bg);
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        
        .tab-button {
            padding: 12px 24px;
            background-color: var(--tab-inactive-bg);
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: var(--tab-inactive);
            transition: all 0.3s;
            margin-right: 5px;
        }
        
        .tab-button:hover {
            background-color: var(--tab-hover-bg);
            color: var(--tab-hover-text);
        }
        
        .tab-button.active {
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–∞–±—ã –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è */
        .mapping-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .mapping-tab {
            padding: 10px 20px;
            background-color: var(--tab-inactive-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            color: var(--tab-inactive);
        }
        
        .mapping-tab:hover {
            background-color: var(--tab-hover-bg);
            color: var(--tab-hover-text);
        }
        
        .mapping-tab.active {
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
            border-color: var(--table-header-bg);
        }
        
        .mapping-table-container {
            display: none;
        }
        
        .mapping-table-container.active {
            display: block;
        }
        
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .action-bar-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-bar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--button-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            color: var(--button-danger);
            font-size: 13px;
            margin-top: 5px;
        }
        
        .info-message {
            color: var(--button-warning);
            font-size: 15px;
            margin-left: 15px;
            display: inline-block;
        }
        
        .solution-container {
            display: flex;
            align-items: center;
            width: 100%;
            gap: 10px;
        }
        
        .success-message {
            color: var(--button-success);
            font-size: 15px;
            margin-left: 15px;
            display: inline-block;
        }
        
        .retry-btn {
            background-color: var(--button-secondary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 13px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .retry-btn:hover {
            background-color: var(--button-secondary-hover);
        }
        
        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: var(--empty-message);
            font-style: italic;
            background-color: transparent;
            font-size: 15px;
        }
        
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫ */
        .rows-info {
            font-size: 13px;
            color: var(--empty-message);
            margin-top: 8px;
            text-align: right;
            font-weight: 500;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ */
        .section-loading-container {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
            font-size: 15px;
            color: var(--button-primary);
        }

        .section-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--button-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border-color);
            border-top: 5px solid var(--button-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-left: 15px;
            font-size: 16px;
            color: var(--text-color);
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--header-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--table-header-bg);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s, border-color 0.3s;
        }

        .section-title .section-loading-container span {
            color: var(--tab-inactive);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ç–µ–≥–æ–≤ –≤ OPC UA</h1>
            <div class="header-right">
                <button id="themeToggle" class="theme-toggle">
                    <span id="themeIcon">üåô</span> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
                </button>
                <button id="infoBtn" class="info-btn">!</button>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
        <div id="infoModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</h2>
                    <button class="close-btn" id="closeModalBtn">&times;</button>
                </div>
                <div class="modal-body">
                    <h3>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º:</h3>
                    <ol>
                        <li><strong>–†–µ—à–µ–Ω–∏—è:</strong> –ó–∞–≥—Ä—É–∑–∏—Ç–µ XML —Ñ–∞–π–ª —Å —Ä–µ—à–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å". –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã.</li>
                        <li><strong>–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞:</strong> –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤, –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤ —Ä–µ—à–µ–Ω–∏–∏.</li>
                        <li><strong>–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º –∏ –æ–±—ä–µ–∫—Ç–∞–º–∏:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ —Å–ø–∏—Å–∫–æ–º –æ–±—ä–µ–∫—Ç–æ–≤.</li>
                        <li><strong>–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:</strong> –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ CSV –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</li>
                        <li><strong>–û–±—ä–µ–∫—Ç—ã:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–í—ã–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ—à–µ–Ω–∏—è" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–π —Å–ø–∏—Å–æ–∫ –∏–∑ CSV —Ñ–∞–π–ª–∞.</li>
                        <li><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫–∞–º–∏:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ "–£–±—Ä–∞—Ç—å —á–µ–∫–∏"/"–ü–æ—Å—Ç–∞–≤–∏—Ç—å —á–µ–∫–∏" –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ —á–µ–∫–±–æ–∫—Å–∞–º–∏, –∏–ª–∏ "–ü–æ—Å—Ç–∞–≤–∏—Ç—å —á–µ–∫–∏ —Ç–æ–ª—å–∫–æ –≥–¥–µ –µ—Å—Ç—å –ì–æ–ª–æ–≤–Ω–æ–π —Ç–µ–≥" –¥–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏.</li>
                        <li><strong>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:</strong> –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –∏–º–ø–æ—Ä—Ç–∞.</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å 1: –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –†–µ—à–µ–Ω–∏—è -->
        <div class="panel">
            <div class="flex-row">
                <div style="flex: 2; position: relative;">
                    <label for="solutionSelect"><strong>–†–µ—à–µ–Ω–∏—è:</strong></label>
                    <div class="solution-container">
                        <select id="solutionSelect" style="width: 100%;">
                            <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—à–µ–Ω–∏–π...</option>
                        </select>
                        <div id="loadingIndicator" class="loading" style="display: none;"></div>
                        <span id="noSolutionsMessage" class="info-message" style="display: none;">–†–µ—à–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</span>
                        <span id="successMessage" class="success-message" style="display: none;">‚úì –†–µ—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã</span>
                    </div>
                    <div id="errorMessage" class="error-message" style="display: none;">
                        –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—à–µ–Ω–∏–π. 
                        <button id="retryBtn" class="retry-btn">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                    </div>
                </div>
                <div>
                    <button id="addSolutionBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                    <button id="deleteSolutionBtn" class="danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    <button id="loadObjectsBtn" class="warning" style="margin-left: 10px;">üìÇ –í—ã–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ—à–µ–Ω–∏—è</button>
                </div>
            </div>

            <!-- –¢–∏–ø –æ–±—ä–µ–∫—Ç–∞ –ø–æ–¥ —Ä–µ—à–µ–Ω–∏—è–º–∏ -->
            <div style="margin-top: 15px;">
                <label for="objectTypeSelect"><strong>–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞:</strong></label>
                <select id="objectTypeSelect" style="width: 400px; margin-left: 10px;">
                    <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–æ–≤...</option>
                </select>
            </div>
        </div>

        <!-- –ï–¥–∏–Ω—ã–π –±–ª–æ–∫ —Å —Ç–∞–±–∞–º–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è -->
        <div class="panel tabs-container">
            <div class="tabs-header">
                <button class="tab-button active" id="tabMappingBtn">–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ</button>
                <button class="tab-button" id="tabObjectsBtn">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</button>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="tab-content active" id="mappingTabContent">
                <div class="section-title">
                    –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∑–∞—â–∏—Ç –∏ –∫–æ–º–∞–Ω–¥
                    <div id="mappingSectionLoading" class="section-loading-container" style="display: none;">
                        <span class="section-loading"></span>
                        <span>–ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤...</span>
                    </div>
                </div>
                
                <div class="action-bar">
                    <div class="action-bar-left">
                        <div class="mapping-tabs">
                            <button class="mapping-tab active" data-mapping="params">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
                            <button class="mapping-tab" data-mapping="protections">–ó–∞—â–∏—Ç—ã</button>
                            <button class="mapping-tab" data-mapping="commands">–ö–æ–º–∞–Ω–¥—ã</button>
                        </div>
                    </div>
                    <div class="action-bar-right">
                        <button id="saveMappingBtn" class="success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button id="loadMappingCsvBtn" class="warning">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ</button>
                        <button id="toggleMappingChecksBtn" class="secondary">üî≤ –£–±—Ä–∞—Ç—å —á–µ–∫–∏</button>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è -->
                <div class="mapping-container">
                    <!-- –¢–∞–±–ª–∏—Ü–∞ 1: –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
                    <div id="paramsTableContainer" class="mapping-table-container active">
                        <div class="table-container">
                            <table id="paramsTable">
                                <thead>
                                    <tr>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ template</th>
                                        <th>–ö–æ–Ω—á–∏–∫ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è OPC UA</th>
                                        <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4" class="empty-message">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- –¢–∞–±–ª–∏—Ü–∞ 2: –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç -->
                    <div id="protectionsTableContainer" class="mapping-table-container">
                        <div class="table-container">
                            <table id="protectionsTable">
                                <thead>
                                    <tr>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞—â–∏—Ç—ã</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ template</th>
                                        <th>–ö–æ–Ω—á–∏–∫ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è OPC UA</th>
                                        <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4" class="empty-message">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- –¢–∞–±–ª–∏—Ü–∞ 3: –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ -->
                    <div id="commandsTableContainer" class="mapping-table-container">
                        <div class="table-container">
                            <table id="commandsTable">
                                <thead>
                                    <tr>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ template</th>
                                        <th>–ö–æ–Ω—á–∏–∫ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è OPC UA</th>
                                        <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="4" class="empty-message">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫ -->
                <div id="mappingRowsInfo" class="rows-info"></div>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏ –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ -->
            <div class="tab-content" id="objectsTabContent">
                <div class="section-title">–°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤</div>
                
                <div class="action-bar">
                    <div class="action-bar-left">
                        <button id="refreshObjectsBtn" class="success">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                        <button id="loadObjectsCsvBtn" class="info">üìÅ –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π —Å–ø–∏—Å–æ–∫</button>
                    </div>
                    <div class="action-bar-right">
                        <button id="toggleObjectsChecksBtn" class="secondary">üî≤ –£–±—Ä–∞—Ç—å —á–µ–∫–∏</button>
                        <button id="toggleObjectsChecksWithTagBtn" class="info">‚úÖ –ü–æ—Å—Ç–∞–≤–∏—Ç—å —á–µ–∫–∏ —Ç–æ–ª—å–∫–æ –≥–¥–µ –µ—Å—Ç—å –ì–æ–ª–æ–≤–Ω–æ–π —Ç–µ–≥</button>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π -->
                <div class="table-container">
                    <table id="objectsTable">
                        <thead>
                            <tr>
                                <th>Id –æ–±—ä–µ–∫—Ç–∞</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ì–æ–ª–æ–≤–Ω–æ–π —Ç–µ–≥ OPC UA</th>
                                <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="empty-message">–ù–∞–∂–º–∏—Ç–µ "–í—ã–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ—à–µ–Ω–∏—è" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫ -->
                <div id="objectsRowsInfo" class="rows-info"></div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
        <div class="footer">
            <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è</h2>
            <div class="generation-options">
                <label><input type="checkbox" id="genHeadTags" checked> –ì–æ–ª–æ–≤–Ω—ã–µ —Ç–µ–≥–∏</label>
                <label><input type="checkbox" id="genProperties" checked> –°–≤–æ–π—Å—Ç–≤–∞</label>
                <label><input type="checkbox" id="genCommands" checked> –ö–æ–º–∞–Ω–¥—ã</label>
                <label><input type="checkbox" id="genProtections" checked> –ó–∞—â–∏—Ç—ã</label>
            </div>
            <button id="generateBtn" style="padding: 12px 24px; font-size: 16px;">‚ö° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã</button>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <input type="file" id="fileInput" class="file-input" accept=".xml">

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CSV —Ñ–∞–π–ª–æ–≤ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è -->
    <input type="file" id="csvFileInput" class="file-input" accept=".csv,.txt">

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CSV —Ñ–∞–π–ª–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ -->
    <input type="file" id="objectsCsvFileInput" class="file-input" accept=".csv,.txt">

    <!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <span class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
    </div>

    <script>
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const solutionSelect = document.getElementById('solutionSelect');
        const addSolutionBtn = document.getElementById('addSolutionBtn');
        const deleteSolutionBtn = document.getElementById('deleteSolutionBtn');
        const loadObjectsBtn = document.getElementById('loadObjectsBtn');
        const objectTypeSelect = document.getElementById('objectTypeSelect');
        const refreshObjectsBtn = document.getElementById('refreshObjectsBtn');
        const loadObjectsCsvBtn = document.getElementById('loadObjectsCsvBtn');
        const generateBtn = document.getElementById('generateBtn');
        const fileInput = document.getElementById('fileInput');
        const csvFileInput = document.getElementById('csvFileInput');
        const objectsCsvFileInput = document.getElementById('objectsCsvFileInput');
        const infoBtn = document.getElementById('infoBtn');
        const infoModal = document.getElementById('infoModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const saveMappingBtn = document.getElementById('saveMappingBtn');
        const loadMappingCsvBtn = document.getElementById('loadMappingCsvBtn');
        const toggleMappingChecksBtn = document.getElementById('toggleMappingChecksBtn');
        const toggleObjectsChecksBtn = document.getElementById('toggleObjectsChecksBtn');
        const toggleObjectsChecksWithTagBtn = document.getElementById('toggleObjectsChecksWithTagBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const noSolutionsMessage = document.getElementById('noSolutionsMessage');
        const successMessage = document.getElementById('successMessage');
        const retryBtn = document.getElementById('retryBtn');
        const mappingRowsInfo = document.getElementById('mappingRowsInfo');
        const objectsRowsInfo = document.getElementById('objectsRowsInfo');
        const mappingSectionLoading = document.getElementById('mappingSectionLoading');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');

        // –¢–∞–±—ã
        const tabMappingBtn = document.getElementById('tabMappingBtn');
        const tabObjectsBtn = document.getElementById('tabObjectsBtn');
        const mappingTabContent = document.getElementById('mappingTabContent');
        const objectsTabContent = document.getElementById('objectsTabContent');

        // –¢–∞–±–ª–∏—Ü—ã
        const paramsTable = document.getElementById('paramsTable');
        const protectionsTable = document.getElementById('protectionsTable');
        const commandsTable = document.getElementById('commandsTable');
        const objectsTable = document.getElementById('objectsTable').querySelector('tbody');

        // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ç–∞–±–ª–∏—Ü —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        const paramsTableContainer = document.getElementById('paramsTableContainer');
        const protectionsTableContainer = document.getElementById('protectionsTableContainer');
        const commandsTableContainer = document.getElementById('commandsTableContainer');

        // –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        const mappingTabs = document.querySelectorAll('.mapping-tab');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
        let mappingChecksState = true;
        let objectsChecksState = true;

        // –•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        let loadedTemplates = null;
        let loadedObjects = null;
        let allObjectTypes = [];

        // –§–ª–∞–≥, –±—ã–ª–∏ –ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —à–∞–±–ª–æ–Ω—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        let templatesLoaded = false;

        // –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∏–ø —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        let currentMappingType = 'params';

        // –ë–∞–∑–æ–≤—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞
        const SERVER_URL = window.location.origin;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                themeIcon.textContent = 'üåô';
                themeToggle.innerHTML = '<span id="themeIcon">üåô</span> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                themeToggle.innerHTML = '<span id="themeIcon">‚òÄÔ∏è</span> –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
                localStorage.setItem('theme', 'dark');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '‚òÄÔ∏è';
                themeToggle.innerHTML = '<span id="themeIcon">‚òÄÔ∏è</span> –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ—è –∑–∞–≥—Ä—É–∑–∫–∏
        function setLoading(isLoading, message = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...') {
            if (isLoading) {
                loadingOverlay.querySelector('.loading-text').textContent = message;
                loadingOverlay.style.display = 'flex';
            } else {
                loadingOverlay.style.display = 'none';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∞–±–∞–º–∏ (–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ / –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤)
        tabMappingBtn.addEventListener('click', () => {
            tabMappingBtn.classList.add('active');
            tabObjectsBtn.classList.remove('active');
            mappingTabContent.classList.add('active');
            objectsTabContent.classList.remove('active');
        });

        tabObjectsBtn.addEventListener('click', () => {
            tabObjectsBtn.classList.add('active');
            tabMappingBtn.classList.remove('active');
            objectsTabContent.classList.add('active');
            mappingTabContent.classList.remove('active');
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        mappingTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                mappingTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const mappingType = tab.dataset.mapping;
                currentMappingType = mappingType;
                
                paramsTableContainer.classList.remove('active');
                protectionsTableContainer.classList.remove('active');
                commandsTableContainer.classList.remove('active');
                
                switch(mappingType) {
                    case 'params':
                        paramsTableContainer.classList.add('active');
                        break;
                    case 'protections':
                        protectionsTableContainer.classList.add('active');
                        break;
                    case 'commands':
                        commandsTableContainer.classList.add('active');
                        break;
                }
                
                updateRowsInfo();
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤
        async function loadTemplates() {
            try {
                mappingSectionLoading.style.display = 'inline-flex';
                
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤...');
                
                const response = await fetch(`${SERVER_URL}/GetTemplate`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
                }

                const data = await response.json();
                console.log('–ü–æ–ª—É—á–µ–Ω—ã —à–∞–±–ª–æ–Ω—ã:', data);
                
                loadedTemplates = data;
                templatesLoaded = true;

                updateObjectTypesDropdown();

                const templateTypes = Object.keys(data);
                if (templateTypes.length > 0 && objectTypeSelect.options.length > 0) {
                    if (!objectTypeSelect.value || objectTypeSelect.value === '') {
                        objectTypeSelect.value = objectTypeSelect.options[0].value;
                    }
                    displayTemplatesForType(objectTypeSelect.value, data);
                } else {
                    showEmptyMappingTables();
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —à–∞–±–ª–æ–Ω–æ–≤:', error);
                templatesLoaded = false;
                showEmptyMappingTables();
            } finally {
                mappingSectionLoading.style.display = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        async function saveMapping() {
            const selectedObjectType = objectTypeSelect.value;

            if (!selectedObjectType || selectedObjectType === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞');
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
            const activeTable = getActiveMappingTable();
            if (!activeTable) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É');
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
            const rows = activeTable.querySelectorAll('tbody tr');
            const mappingData = [];

            console.log('–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã, –Ω–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–æ–∫:', rows.length);

            rows.forEach((row, index) => {
                if (row.querySelector('.empty-message')) return;

                const descriptionCell = row.querySelector('td:nth-child(2)');
                const opcUaInput = row.querySelector('td:nth-child(3) input');
                const useCheckbox = row.querySelector('td:last-child input');

                let description = '';
                let opcUaPath = '';
                let use = true;

                if (descriptionCell) {
                    description = descriptionCell.textContent?.trim() || '';
                }

                if (opcUaInput) {
                    opcUaPath = opcUaInput.value?.trim() || '';
                }

                if (useCheckbox) {
                    use = useCheckbox.checked;
                }

                if (description && opcUaPath) {
                    mappingData.push({
                        Description: description,
                        OpcUaPath: opcUaPath,
                        Use: use
                    });
                }
            });

            console.log('–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', mappingData);

            if (mappingData.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                return;
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const saveData = {
                ObjectType: selectedObjectType,
                MappingType: currentMappingType,
                Data: mappingData
            };

            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:', JSON.stringify(saveData, null, 2));

            try {
                setLoading(true, '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è...');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
                const testResponse = await fetch(`${SERVER_URL}/getAllSolution`, {
                    method: 'GET',
                    mode: 'cors'
                }).catch(() => null);

                if (!testResponse || !testResponse.ok) {
                    throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
                }

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                const response = await fetch(`${SERVER_URL}/SaveTemplates`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(saveData)
                });

                console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
                console.log('–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', [...response.headers.entries()]);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏:', errorText);
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
                }

                const result = await response.json();
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', result);
                
                alert(`–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ. –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${result.count}`);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);

                let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + error.message;

                if (error.message.includes('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω')) {
                    errorMessage = '‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:\n' +
                        '1. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080\n' +
                        '2. –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ CORS\n' +
                        '3. –ê–¥—Ä–µ—Å http://127.0.0.1:8080 –¥–æ—Å—Ç—É–ø–µ–Ω';
                }

                alert(errorMessage);
            } finally {
                setLoading(false);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–∑ CSV —Ñ–∞–π–ª–∞
        function loadMappingFromCsv() {
            csvFileInput.accept = '.csv,.txt';
            csvFileInput.click();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ CSV —Ñ–∞–π–ª–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        csvFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                parseCsvFile(file, 'mapping');
            }
            csvFileInput.value = '';
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CSV —Ñ–∞–π–ª–∞ –æ–±—ä–µ–∫—Ç–æ–≤
        function loadObjectsFromCsv() {
            objectsCsvFileInput.accept = '.csv,.txt';
            objectsCsvFileInput.click();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ CSV —Ñ–∞–π–ª–∞ –æ–±—ä–µ–∫—Ç–æ–≤
        objectsCsvFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                parseCsvFile(file, 'objects');
            }
            objectsCsvFileInput.value = '';
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV —Ñ–∞–π–ª–∞
        function parseCsvFile(file, type) {
            const reader = new FileReader();
            
            reader.onload = (event) => {
                const content = event.target.result;
                const lines = content.split('\n').filter(line => line.trim() !== '');
                
                let delimiter = '\t';
                if (content.includes(',')) delimiter = ',';
                else if (content.includes(';')) delimiter = ';';
                
                const data = [];
                
                lines.forEach(line => {
                    const parts = line.split(delimiter).map(part => part.trim());
                    if (parts.length >= 2) {
                        data.push({
                            id: parts[0],
                            value: parts[1]
                        });
                    }
                });
                
                if (data.length === 0) {
                    alert('–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç');
                    return;
                }
                
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ CSV (${type}):`, data);
                
                if (type === 'mapping') {
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                    const activeTable = getActiveMappingTable();
                    const tbody = activeTable?.querySelector('tbody');
                    
                    if (tbody) {
                        tbody.innerHTML = '';
                        
                        data.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td></td>
                                <td class="non-editable-text">${escapeHtml(item.id)}</td>
                                <td><input type="text" class="editable-input" value="${escapeHtml(item.value)}"></td>
                                <td class="editable-col"><input type="checkbox" checked></td>
                            `;
                            tbody.appendChild(row);
                        });
                        
                        mappingChecksState = true;
                        updateButtonText(toggleMappingChecksBtn, mappingChecksState);
                        
                        updateRowsInfo();
                        
                        alert(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.length} —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—É —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è`);
                    }
                } else if (type === 'objects') {
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É –æ–±—ä–µ–∫—Ç–æ–≤
                    if (objectsTable) {
                        objectsTable.innerHTML = '';
                        
                        data.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${escapeHtml(item.id)}</td>
                                <td></td>
                                <td><input type="text" class="editable-input" value="${escapeHtml(item.value)}"></td>
                                <td class="checkbox-col"><input type="checkbox" checked></td>
                            `;
                            objectsTable.appendChild(row);
                        });
                        
                        objectsChecksState = true;
                        updateButtonText(toggleObjectsChecksBtn, objectsChecksState);
                        
                        updateRowsInfo();
                        
                        alert(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.length} –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ CSV —Ñ–∞–π–ª–∞`);
                    }
                }
            };
            
            reader.readAsText(file);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
        function updateObjectTypesDropdown() {
            const currentValue = objectTypeSelect.value;
            
            objectTypeSelect.innerHTML = '';
            
            const allTypes = new Set();
            
            if (loadedTemplates) {
                Object.keys(loadedTemplates).forEach(type => allTypes.add(type));
            }
            
            if (loadedObjects) {
                Object.keys(loadedObjects).forEach(type => allTypes.add(type));
            }
            
            const typesArray = Array.from(allTypes).sort();
            allObjectTypes = typesArray;
            
            console.log('–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤:', typesArray);
            
            if (typesArray.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = '–ù–µ—Ç —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤';
                objectTypeSelect.appendChild(option);
                return;
            }
            
            typesArray.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                objectTypeSelect.appendChild(option);
            });
            
            if (currentValue && typesArray.includes(currentValue)) {
                objectTypeSelect.value = currentValue;
            }
            
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞
        function displayTemplatesForType(type, templates) {
            console.log('–û—Ç–æ–±—Ä–∞–∂–∞–µ–º —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Ç–∏–ø–∞:', type);
            
            if (!templates || !templates[type]) {
                console.log('–ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è —Ç–∏–ø–∞:', type);
                showEmptyMappingTables();
                return;
            }

            const typeData = templates[type];
            
            if (typeData.params && typeData.params.length > 0) {
                fillMappingTable('params', typeData.params);
            } else {
                showEmptyMappingTable('params');
            }
            
            if (typeData.protections && typeData.protections.length > 0) {
                fillMappingTable('protections', typeData.protections);
            } else {
                showEmptyMappingTable('protections');
            }
            
            if (typeData.commands && typeData.commands.length > 0) {
                fillMappingTable('commands', typeData.commands);
            } else {
                showEmptyMappingTable('commands');
            }

            mappingChecksState = true;
            updateButtonText(toggleMappingChecksBtn, mappingChecksState);
            
            updateRowsInfo();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–æ–∫
        function updateRowsInfo() {
            const activeTable = getActiveMappingTable();
            if (activeTable) {
                const tbody = activeTable.querySelector('tbody');
                const rows = tbody.querySelectorAll('tr:not(.empty-message)').length;
                mappingRowsInfo.textContent = rows > 0 ? `–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: ${rows}` : '';
            }

            if (objectsTable) {
                const rows = objectsTable.querySelectorAll('tr:not(.empty-message)').length;
                objectsRowsInfo.textContent = rows > 0 ? `–í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${rows}` : '';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        function getActiveMappingTable() {
            switch(currentMappingType) {
                case 'params': return paramsTable;
                case 'protections': return protectionsTable;
                case 'commands': return commandsTable;
                default: return null;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—à–µ–Ω–∏–π —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadSolutions() {
            try {
                loadingIndicator.style.display = 'inline-block';
                noSolutionsMessage.style.display = 'none';
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
                solutionSelect.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—à–µ–Ω–∏–π...</option>';

                const response = await fetch(`${SERVER_URL}/getAllSolution`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
                }
                
                const text = await response.text();
                if (!text) {
                    throw new Error('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
                const solutions = JSON.parse(text);
                console.log('–ü–æ–ª—É—á–µ–Ω—ã —Ä–µ—à–µ–Ω–∏—è:', solutions);
                
                solutionSelect.innerHTML = '';
                
                if (solutions && solutions.length > 0) {
                    solutions.forEach(solution => {
                        const option = document.createElement('option');
                        option.value = solution.NameFile;
                        option.textContent = solution.Discript;
                        solutionSelect.appendChild(option);
                    });
                    noSolutionsMessage.style.display = 'none';
                    successMessage.style.display = 'inline-block';
                    
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                    
                    return solutions;
                } else {
                    solutionSelect.innerHTML = '<option value="">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π</option>';
                    noSolutionsMessage.style.display = 'inline-block';
                    successMessage.style.display = 'none';
                    return [];
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ—à–µ–Ω–∏–π:', error);
                errorMessage.style.display = 'block';
                solutionSelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
                noSolutionsMessage.style.display = 'none';
                successMessage.style.display = 'none';
                throw error;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
        solutionSelect.addEventListener('change', async (e) => {
            console.log('–í—ã–±—Ä–∞–Ω–æ —Ä–µ—à–µ–Ω–∏–µ:', e.target.value);
            if (e.target.value && e.target.value !== '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π' && e.target.value !== '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏') {
                await loadTemplates();
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ —Ä–µ—à–µ–Ω–∏—è
        async function loadObjectsFromSolution() {
            const selectedSolution = solutionSelect.value;
            
            if (!selectedSolution || selectedSolution === '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π' || selectedSolution === '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ');
                return;
            }

            try {
                setLoading(true, '–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ —Ä–µ—à–µ–Ω–∏—è...');
                
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Ñ–∞–π–ª–∞:', selectedSolution);
                
                const response = await fetch(`${SERVER_URL}/GetTypeObjects`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        filename: selectedSolution
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}, ${errorText}`);
                }

                const data = await response.json();
                console.log('–ü–æ–ª—É—á–µ–Ω—ã –æ–±—ä–µ–∫—Ç—ã –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);

                loadedObjects = data;
                updateObjectTypesDropdown();

                const currentObjectType = objectTypeSelect.value;
                
                if (currentObjectType && data[currentObjectType]) {
                    displayObjectsForType(currentObjectType, data);
                } else if (allObjectTypes.length > 0) {
                    const firstType = allObjectTypes[0];
                    objectTypeSelect.value = firstType;
                    
                    if (loadedTemplates && loadedTemplates[firstType]) {
                        displayTemplatesForType(firstType, loadedTemplates);
                    }
                    
                    if (data[firstType]) {
                        displayObjectsForType(firstType, data);
                    }
                }

                alert('–û–±—ä–µ–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–±—ä–µ–∫—Ç–æ–≤:', error);
                alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–±—ä–µ–∫—Ç–æ–≤: ${error.message}`);
            } finally {
                setLoading(false);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞
        function displayObjectsForType(objectType, objectsData) {
            console.log('–û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –¥–ª—è —Ç–∏–ø–∞:', objectType);
            
            if (!objectsData || !objectsData[objectType]) {
                console.log('–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Ç–∏–ø–∞:', objectType);
                showEmptyObjectsTable();
                return;
            }

            const typeData = objectsData[objectType];
            
            if (typeData.objects && typeData.objects.length > 0) {
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤:', typeData.objects.length);
                fillObjectsTable(typeData.objects);
            } else {
                showEmptyObjectsTable();
            }

            objectsChecksState = true;
            updateButtonText(toggleObjectsChecksBtn, objectsChecksState);
            
            updateRowsInfo();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ–∫–±–æ–∫—Å–æ–≤ —Ç–æ–ª—å–∫–æ —É –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —Ç–µ–≥–æ–º
        function toggleChecksOnlyWithTag() {
            if (!objectsTable) return;
            
            const rows = objectsTable.querySelectorAll('tr');
            let checkedCount = 0;
            let totalWithTag = 0;
            
            rows.forEach(row => {
                if (row.querySelector('.empty-message')) return;
                
                const tagInput = row.querySelector('td:nth-child(3) input');
                const checkbox = row.querySelector('td:last-child input[type="checkbox"]');
                
                if (tagInput && checkbox) {
                    const hasTag = tagInput.value?.trim() !== '';
                    if (hasTag) {
                        totalWithTag++;
                        checkbox.checked = true;
                        checkedCount++;
                    } else {
                        checkbox.checked = false;
                    }
                }
            });
            
            objectsChecksState = false; // –ü–æ—Å–ª–µ —ç—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–≤—Å–µ –æ—Ç–º–µ—á–µ–Ω—ã" —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
            updateButtonText(toggleObjectsChecksBtn, objectsChecksState);
            
            alert(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ–∫–±–æ–∫—Å—ã –¥–ª—è ${checkedCount} –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –ì–æ–ª–æ–≤–Ω—ã–º —Ç–µ–≥–æ–º –∏–∑ ${totalWithTag} –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö`);
            updateRowsInfo();
        }

        function showEmptyMappingTables() {
            const tables = ['params', 'protections', 'commands'];
            tables.forEach(tableType => {
                showEmptyMappingTable(tableType);
            });
        }

        function showEmptyMappingTable(tableType) {
            const tbody = getTableBody(tableType);
            if (tbody) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-message">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
            }
        }

        function showEmptyObjectsTable() {
            if (objectsTable) {
                objectsTable.innerHTML = '<tr><td colspan="4" class="empty-message">–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
            }
        }

        function getTableBody(tableType) {
            switch(tableType) {
                case 'params': return paramsTable?.querySelector('tbody');
                case 'protections': return protectionsTable?.querySelector('tbody');
                case 'commands': return commandsTable?.querySelector('tbody');
                default: return null;
            }
        }

        function fillMappingTable(tableType, data) {
            const tbody = getTableBody(tableType);
            if (!tbody) return;
            
            console.log(`–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã ${tableType} –¥–∞–Ω–Ω—ã–º–∏:`, data);
            
            tbody.innerHTML = '';
            
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-message">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
                return;
            }
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td></td>
                    <td class="non-editable-text">${escapeHtml(item.description || item.Description || '')}</td>
                    <td><input type="text" class="editable-input" value="${escapeHtml(item.opcUaPath || item.OPCUAPath || '')}"></td>
                    <td class="editable-col"><input type="checkbox" ${item.use ? 'checked' : ''}></td>
                `;
                tbody.appendChild(row);
            });
            
            console.log(`–¢–∞–±–ª–∏—Ü–∞ ${tableType} –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, —Å—Ç—Ä–æ–∫:`, data.length);
        }

        function fillObjectsTable(objects) {
            if (!objectsTable) return;
            
            console.log('–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ–±—ä–µ–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã–º–∏:', objects);
            
            objectsTable.innerHTML = '';
            
            if (!objects || objects.length === 0) {
                objectsTable.innerHTML = '<tr><td colspan="4" class="empty-message">–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
                return;
            }
            
            objects.forEach(obj => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${escapeHtml(obj.id || '')}</td>
                    <td>${escapeHtml(obj.name || '')}</td>
                    <td><input type="text" class="editable-input" value="${escapeHtml(obj.tag || '')}"></td>
                    <td class="checkbox-col"><input type="checkbox" ${obj.use ? 'checked' : ''}></td>
                `;
                objectsTable.appendChild(row);
            });
            
            console.log('–¢–∞–±–ª–∏—Ü–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, —Å—Ç—Ä–æ–∫:', objects.length);
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        async function uploadSolution(file) {
            try {
                setLoading(true, '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
                
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch(`${SERVER_URL}/AddSolution`, {
                    method: 'POST',
                    mode: 'cors',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}, ${errorText}`);
                }
                
                const result = await response.json();
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏:', result);
                
                alert(`–§–∞–π–ª "${file.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä`);
                
                await loadSolutions();
                await loadTemplates();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞:', error);
                alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ${error.message}`);
            } finally {
                setLoading(false);
            }
        }

        function toggleChecksInTable(tableBody, setChecked) {
            if (!tableBody) return;
            const checkboxes = tableBody.querySelectorAll('td:last-child input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = setChecked;
            });
        }

        function toggleChecksInActiveMappingTable(setChecked) {
            const activeTable = getActiveMappingTable();
            if (activeTable) {
                const tbody = activeTable.querySelector('tbody');
                if (tbody && !tbody.querySelector('.empty-message')) {
                    toggleChecksInTable(tbody, setChecked);
                }
            }
        }

        function updateButtonText(button, state) {
            if (state) {
                button.innerHTML = '‚úÖ –ü–æ—Å—Ç–∞–≤–∏—Ç—å —á–µ–∫–∏';
                button.classList.remove('secondary');
                button.classList.add('success');
            } else {
                button.innerHTML = 'üî≤ –£–±—Ä–∞—Ç—å —á–µ–∫–∏';
                button.classList.remove('success');
                button.classList.add('secondary');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤
        async function generateObjects() {
            const selectedObjectType = objectTypeSelect.value;
            
            if (!selectedObjectType || selectedObjectType === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–æ –ª–∏ —Ä–µ—à–µ–Ω–∏–µ
            if (!solutionSelect.value || solutionSelect.value === '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π' || solutionSelect.value === '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ');
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–æ–≤ –æ–ø—Ü–∏–π
            const options = {
                headTags: document.getElementById('genHeadTags').checked,
                properties: document.getElementById('genProperties').checked,
                commands: document.getElementById('genCommands').checked,
                protections: document.getElementById('genProtections').checked
            };

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –æ–ø—Ü–∏—è
            if (!options.headTags && !options.properties && !options.commands && !options.protections) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ–ø—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏');
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –æ–±—ä–µ–∫—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏)
            const objectsList = [];
            const objectRows = objectsTable.querySelectorAll('tr');
            
            objectRows.forEach(row => {
                if (row.querySelector('.empty-message')) return;
                
                const checkbox = row.querySelector('td:last-child input[type="checkbox"]');
                const tagInput = row.querySelector('td:nth-child(3) input');
                const id = row.cells?.[0]?.innerText?.trim() || '';
                const tag = tagInput?.value?.trim() || '';
                
                if (checkbox && checkbox.checked) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–ø–æ–ª–Ω–µ–Ω –≥–æ–ª–æ–≤–Ω–æ–π —Ç–µ–≥
                    if (!tag) {
                        alert(`–£ –æ–±—ä–µ–∫—Ç–∞ —Å ID "${id}" –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω –ì–æ–ª–æ–≤–Ω–æ–π —Ç–µ–≥ OPC UA. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.`);
                        throw new Error('Empty tag'); // –ü—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                    }
                    objectsList.push({ id, tag });
                }
            });

            if (objectsList.length === 0) {
                alert('–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏');
                return;
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
            const requestBody = {
                filename: solutionSelect.value,
                objectType: selectedObjectType,
                options: options,
                objects: objectsList
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏
            if (options.properties || options.commands || options.protections) {
                requestBody.mappings = {};
                
                if (options.properties) {
                    const paramsData = getCheckedMappingData('params');
                    if (paramsData.length > 0) {
                        requestBody.mappings.params = paramsData;
                    }
                }
                
                if (options.protections) {
                    const protectionsData = getCheckedMappingData('protections');
                    if (protectionsData.length > 0) {
                        requestBody.mappings.protections = protectionsData;
                    }
                }
                
                if (options.commands) {
                    const commandsData = getCheckedMappingData('commands');
                    if (commandsData.length > 0) {
                        requestBody.mappings.commands = commandsData;
                    }
                }
            }

            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é:', requestBody);

            try {
                setLoading(true, '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–∞...');

                const response = await fetch(`${SERVER_URL}/GetResultFile`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}, ${errorText}`);
                }

                // –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Content-Disposition –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = 'result.xml';
                if (contentDisposition) {
                    const match = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                    if (match && match[1]) {
                        filename = match[1].replace(/['"]/g, '');
                    }
                }

                // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                alert('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:', error);
                if (error.message !== 'Empty tag') {
                    alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${error.message}`);
                }
            } finally {
                setLoading(false);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        function getCheckedMappingData(mappingType) {
            const table = getMappingTableByType(mappingType);
            if (!table) return [];

            const tbody = table.querySelector('tbody');
            if (!tbody) return [];

            const rows = tbody.querySelectorAll('tr');
            const data = [];

            rows.forEach(row => {
                if (row.querySelector('.empty-message')) return;
                
                const checkbox = row.querySelector('td:last-child input');
                const descriptionCell = row.querySelector('td:nth-child(2)');
                const tagInput = row.querySelector('td:nth-child(3) input');
                
                if (checkbox && checkbox.checked) {
                    const description = descriptionCell?.textContent?.trim() || '';
                    const tag = tagInput?.value?.trim() || '';
                    
                    if (description && tag) {
                        data.push({
                            description: description,
                            tag: tag
                        });
                    }
                }
            });

            return data;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ —Ç–∏–ø—É —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        function getMappingTableByType(mappingType) {
            switch(mappingType) {
                case 'params': return paramsTable;
                case 'protections': return protectionsTable;
                case 'commands': return commandsTable;
                default: return null;
            }
        }

        async function initializePage() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
            loadSavedTheme();
            
            setLoading(true, '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—à–µ–Ω–∏–π...');
            
            try {
                await loadSolutions();
                await loadTemplates();
                showEmptyObjectsTable();
                
                tabMappingBtn.click();
                
                console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showEmptyMappingTables();
                showEmptyObjectsTable();
            } finally {
                setLoading(false);
                
                updateButtonText(toggleMappingChecksBtn, mappingChecksState);
                updateButtonText(toggleObjectsChecksBtn, objectsChecksState);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('DOMContentLoaded', initializePage);

        infoBtn.addEventListener('click', () => {
            infoModal.style.display = 'block';
        });

        closeModalBtn.addEventListener('click', () => {
            infoModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === infoModal) {
                infoModal.style.display = 'none';
            }
        });

        retryBtn.addEventListener('click', async () => {
            setLoading(true, '–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            await loadSolutions();
            await loadTemplates();
            setLoading(false);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        saveMappingBtn.addEventListener('click', async () => {
            console.log('üîµ –ö–Ω–æ–ø–∫–∞ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∂–∞—Ç–∞');
            console.log('üìå –¢–µ–∫—É—â–∏–π —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞:', objectTypeSelect.value);
            console.log('üìå –¢–µ–∫—É—â–∏–π —Ç–∏–ø —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:', currentMappingType);
            console.log('üìå –ê–∫—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:', getActiveMappingTable()?.id);
            
            await saveMapping();
        });

        loadMappingCsvBtn.addEventListener('click', loadMappingFromCsv);
        loadObjectsBtn.addEventListener('click', loadObjectsFromSolution);
        loadObjectsCsvBtn.addEventListener('click', loadObjectsFromCsv);

        refreshObjectsBtn.addEventListener('click', () => {
            if (loadedObjects && objectTypeSelect.value) {
                displayObjectsForType(objectTypeSelect.value, loadedObjects);
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –æ–±—ä–µ–∫—Ç—ã');
            }
        });

        objectTypeSelect.addEventListener('change', (e) => {
            console.log('–ò–∑–º–µ–Ω–µ–Ω —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞:', e.target.value);
            const selectedType = e.target.value;
            
            if (!selectedType) return;
            
            if (loadedTemplates && loadedTemplates[selectedType]) {
                displayTemplatesForType(selectedType, loadedTemplates);
            } else {
                showEmptyMappingTables();
            }
            
            if (loadedObjects && loadedObjects[selectedType]) {
                displayObjectsForType(selectedType, loadedObjects);
            } else {
                showEmptyObjectsTable();
            }
        });

        toggleMappingChecksBtn.addEventListener('click', () => {
            toggleChecksInActiveMappingTable(mappingChecksState);
            mappingChecksState = !mappingChecksState;
            updateButtonText(toggleMappingChecksBtn, mappingChecksState);
        });

        toggleObjectsChecksBtn.addEventListener('click', () => {
            toggleChecksInTable(objectsTable, objectsChecksState);
            objectsChecksState = !objectsChecksState;
            updateButtonText(toggleObjectsChecksBtn, objectsChecksState);
        });

        toggleObjectsChecksWithTagBtn.addEventListener('click', toggleChecksOnlyWithTag);

        addSolutionBtn.addEventListener('click', () => {
            fileInput.accept = '.xml';
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                uploadSolution(file);
            }
            fileInput.value = '';
        });

        deleteSolutionBtn.addEventListener('click', () => {
            alert('–£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
        });

        themeToggle.addEventListener('click', toggleTheme);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        generateBtn.addEventListener('click', generateObjects);
    </script>
</body>
</html>